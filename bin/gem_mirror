#!/usr/bin/env ruby
#
#   Author: Rohith (gambol99@gmail.com)
#   Date: 2014-07-30 13:53:02 +0100 (Wed, 30 Jul 2014)
#
#  vim:ts=4:sw=4:et
#
require 'rubygems' if RUBY_VERSION < '1.9.0'
require 'optparse'
require 'gem_mirror'

module GemMirror
  class CLI
    include GemMirror::Utils
    include GemMirror::Logging

    def initialize
      begin
        parser.parse!
      rescue SystemExit => e
        exit e.status
      rescue Exception => e
        parser.usage e.message
      end
    end

    private


    def settings filename = options[:config]
      unless @settings
        if options[:config]
          @setting = load_settings_file
        else


        end
      end
    end

    def load_settings_file filename = options[:config]
      validate_file filename
      info "loading the configuration file: #{filename}"
      config = YAML.load(File.read(filename))
      # step: validate we have t

    end

    def options
      @options ||= set_default_options
    end

    def set_default_options
      { :threads => 10 }
    end

    def parser
      @parser ||= OptionParse.new do |o|
        o.on( '-c CONFIG', '--config CONFIG', 'the location of the configuration file' ) { |x| options[:config] = x }
        o.on( '-s URL', '--source SOURCE_URL', 'the source url to mirror gems from' ) { |x| options[:source] = x }
        o.on( '-d DIRECTORY', '--dest DIRECTORY', 'the directory to save the gems to' ) { |x| options[:dest] = x }
        o.on
        o.on( '-v', '--verbose', 'switch on verbose mode' ) { options[:verbose] = true }
      end
    end
  end
end

GemMirror::CLI.new

